name: Deploy

on:
  push:
    branches:
      - main

jobs:
  release:
    uses: ./.github/workflows/release.yaml
    secrets: inherit

  build:
    runs-on: ubuntu-latest
    needs: [release]
    if: needs.release.outputs.new_release == 'true' #
    steps:
      - name: build step
        run: echo build cmd
  deploy:
    runs-on: ubuntu-latest
    needs: [build]
    steps:
      - name: Deploy step
        run: |
          echo deploy ${{ needs.release.outputs.new_release_version }}
          echo IMAGE_TAG=${{ needs.release.outputs.new_release_version }} >> $GITHUB_ENV 
          
      - name: verify step
        run: |
          echo from job: ${{ needs.release.outputs.new_release_version }}
          echo from job: needs.release.outputs.new_release_version
          echo from var: $IMAGE_TAG
          echo from env: ${{ env.IMAGE_TAG }}
          echo $(git describe --tags)
